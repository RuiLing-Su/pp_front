import{u as pe,G as me,D as fe,H as ve,r as b,z as _e,d as c,I as ge,o as d,c as m,f as t,h as o,i,J as C,K as U,m as D,p as f,A as _,e as s,L as X,n as I,M as he,N as be,O as ye,x as ke}from"./index-B5XNB-yB.js";import{l as Ve}from"./category-BasmY3_F.js";import{l as F}from"./dish-CZ97_zVS.js";import{g as Ae,u as we,a as Ce}from"./setmeal-BfMh4nJs.js";const Ue="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAiCAYAAAA6RwvCAAAFJElEQVRYR+2WW2wUZRTH//+Zli0SFLSIEaoPpiG2dGaF7c52ZyUKD0YTbhq8AA/GCGrwAgTRxGsEoga1mKAmqDE+AIlECCQgARVjutvZbWV3tqUBihovaCBgkISWlt3vmOmF1GUvrcQEE+f1XL7f/M/5zneIK+TjFcKB/y6I4xyqUcjMVUAAxI0ArqfgDIjfAOnQtLJdoUBtM0k1ErWHrUhzwp2tFNYJpK7kAcTvJNf6NOPDQIAXSvoDpUvjtLVNzHZlt4rgTi8hwZMgdmnU9lOpn3WdJzOUcVCYJILbRWSeANX9vuikjgfC9f5kKZiiisRaUrcpxZ0QqfIACL42qqxuU6m/bGpx50DJ6xDUkOgitIfDlrGtGExBkGhr2y3IqIRAriX5rU+vuC8QmHKq1J8N2ltbpbwn424UYKnXL6JxdqTe2FMoPi9I0+HDY3mmJy6QW0nu9OnGglIqFDogGndfEZFXSZylrlnhgHE4n29ekGg89YYIngOYHjsaYdM0zw1XiXx+0bi7RUQeInHAtvwzhwXiOO7kLOQoyApNR6AhYB68HAgv1nE6r87w3PcQVOq6dk9DvfFFbs5LFIk6qTUCvEhyq22ZC3MDRESLt7dPCNXVnci1JZM/juuuLOsJV1V159pijrtcQRpJ7LMt/13DAHHT3qwgOcu2zK9zA5oSbiMFT4N4yg6a7w/ao4n0DFGym5S0bfnt3Lh0Oj3+bJc6SUJ0GVMZClWfHerzN0ViqSOT1PnuX0GcsYPmBJKZ3ITRFvdBycrWvjmhcZkH0wchsgciYzSiMWz5Vxbola9EZKZG/d6wVbejIEhzS7udzWaaAEQjIX+kUG/EnPQyBbXRs3sHK3CpB0Hgk7BlPlpovMfiqXeUYAWorYxYRmNhReLpBUrUZyS32ZZ5f7EmHQozMEWLQng+McddpSDrofGtSNB8thjIQiVqM8gtEctcVAxkoBz7IOLrU0bXngzXG+8VhU+4zyglGwi+a4fM5UVK03ZHNps9AOCbSMjf97bkrfWQniDYLJCGoT1TMG5gPpHa87ZlvFkQxEl2VGd6eo8SOG6H/JPzJXQcN5QhvhzaE83xticGewbkkohlfpQvtime2g7BfGja4kjQ2FwQxDNE4+4vIjJZ0zEt36sZddxNAlmS25gXe4ZwI5bfnwvS2dnpO3G66xSJMfRVVIX9U44XBWlKpDZCYRnBt+2QuSo3obcWSLcKhuqN3bm3w2lNRZAp/yMUqu3IjYtdvAhosS1/MNd+yWT1nn5R/A4i51kxujqXvFgzFrKJSFkskW4XkSkatMfCIWNTSZCB8gw8UtwZDhrzSco/ARiMicbdF0RkLckj4aAxNd+gzP/6Huy4WXovJAEZD2hrIiHj5X8K4i1JVOifoqLdbYfq9uXLVXAxiiXcWUrJXgBl0LjBrjdWkcyOBCjmpB4R8gMRGQVydcQy1xeKL7oqNiXSiyDycf/QYhM1faUdnNpSCqa19dBNPZkL6wRY7Plq5PqwZa4uFldyi4/G0w0C2Q6RG7xeEcFejfh8lF62f/r0muOeSiLCZPJYZXe2awayMk/IBQPw53Xi8QbL/LQUfEkQL4G32GTZtRqQFSK4ajBp3y4KOU3wmj75B76Ba70Z5eUv2dNqfioF4dmHBTKYqLX1SGVvpnuOgHMBCQgwEYDep1Q/UAcou0ZR21Ffb/wwHICL8CNxzvX1trVk8th1Pl/vn7W1tb2Xk2tEilzOQaVi/wcZ1ogvJeO/Yf8LOUhWQdfhhAAAAAAASUVORK5CYII=",Ie={class:"container"},Le={class:"addDish"},xe={key:1,class:"content"},Se={class:"action-buttons"},De={class:"table"},Ne={class:"subBox address"},Qe={class:"addDishCon"},Ze={class:"leftCont"},Be={class:"tabBut"},Ee=["onClick"],Ge={class:"tabList"},Re={class:"table"},qe={key:0,style:{"padding-left":"10px"}},Xe={class:"item"},Fe={style:{flex:"3","text-align":"left"}},Oe={class:"ritCont"},ze={class:"tit"},Me={class:"items"},je={class:"price"},He=["onClick"],Je=s("img",{src:Ue,alt:""},null,-1),Ye=[Je],We={class:"dialog-footer"},ll={__name:"info",setup(Ke){const O=pe();me(()=>{const a=O.params.data;a?(console.log("这是修改操作，ID为:",a),Ae(a).then(e=>{n.value=e.data,v.value=e.data.setmealDishList})):console.log("这是新增操作")});const{proxy:L}=ke(),{seal_system:z}=L.useDict("seal_system"),M=fe({form:{},rules:{name:[{required:!0,message:"请输入套餐名称",trigger:"blur"}],categoryId:[{required:!0,message:"请选择套餐分类",trigger:"change"}],price:[{required:!0,message:"请输入套餐价格",trigger:"blur"}]}}),{form:n,rules:j}=ve(M),k=b(null);function H(){k.value&&k.value.resetFields(),n.value={id:null,categoryId:null,name:null,price:null,status:null,code:null,description:null,image:null,createTime:null,updateTime:null},v.value=[],L.resetForm("setmealRef")}const V=b(!1),A=b(""),v=b([]),N=b(0),Q={},x=b([]),y=b([]),h=b([]),J=()=>{h.value.forEach(a=>{a.copies===void 0&&(a.copies=1)})},Z=async a=>{try{if(!k.value){console.error("表单引用未找到");return}await k.value.validate(async e=>{if(e){n.value.setmealDishList=v.value.map(u=>({dishId:u.id,name:u.name,price:u.price,copies:u.copies}));let r;n.value.id?r=await we(n.value):r=await Ce(n.value),r.code===200?(L.$message.success("操作成功"),a?H():R()):L.$message.error(r.msg||"操作失败")}else console.log("表单验证失败")})}catch(e){console.log("提交出错：",e)}};function B(){if(V.value=!0,N.value=0,h.value=[],x.value.length>0){const a=x.value[0].id;q(a)}}const E=()=>{V.value=!1},G=async()=>{try{y.value=[],console.log("搜索关键字：",A.value);const a=await F({name:A.value});a.rows.forEach(e=>{y.value.push(e),console.log("搜索结果：",a)})}catch(a){console.log("搜索出错：",a)}},Y=()=>{const a=h.value.filter(e=>(console.log("newDish.id:",e.id),!v.value.some(r=>r.id===e.id)));v.value.push(...a),w.value=w.value,V.value=!1},W=a=>{v.value.splice(a,1),w.value=w.value},R=()=>{},K=(a,e)=>{N.value=a,q(e)},T=a=>{h.value.splice(a,1)},P=async()=>{try{(await Ve()).rows.forEach(e=>{e.type===1?Q[e.id]=e.name:e.type===0&&x.value.push(e)})}catch(a){console.log("发生错误：",a)}},q=async a=>{try{y.value=[],console.log("categoryId:",a);const e=await F({categoryId:a});e.rows.forEach(r=>{y.value.push(r),console.log("搜索结果：",e)})}catch(e){console.log("获取菜品列表出错：",e)}};P();const w=_e(()=>v.value.reduce((a,e)=>{const r=e.copies?Number(e.copies):1;return a+Number(e.price)*r},0));return(a,e)=>{const r=c("el-input"),u=c("el-form-item"),$=c("el-option"),ee=c("el-select"),le=c("el-radio"),te=c("el-radio-group"),ae=c("image-upload"),g=c("el-button"),S=c("el-table-column"),oe=c("el-input-number"),se=c("el-table"),ne=c("el-form"),ie=c("el-checkbox"),re=c("el-checkbox-group"),ue=c("el-dialog"),ce=ge("hasPermi");return d(),m("div",Ie,[t(ne,{ref_key:"setmealRef",ref:k,model:i(n),rules:i(j),inline:!0,"label-width":"180px"},{default:o(()=>[t(u,{label:"套餐名称:",prop:"name"},{default:o(()=>[t(r,{modelValue:i(n).name,"onUpdate:modelValue":e[0]||(e[0]=l=>i(n).name=l),placeholder:"请填写套餐名称",maxlength:"20"},null,8,["modelValue"])]),_:1}),t(u,{label:"套餐分类:",prop:"categoryId"},{default:o(()=>[t(ee,{modelValue:i(n).categoryId,"onUpdate:modelValue":e[1]||(e[1]=l=>i(n).categoryId=l),placeholder:"请选择套餐分类",onChange:e[2]||(e[2]=l=>a.$forceUpdate()),clearable:""},{default:o(()=>[(d(),m(C,null,U(Q,(l,p)=>t($,{key:p,label:l,value:p},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(u,{label:"套餐价格:",prop:"price"},{default:o(()=>[t(r,{modelValue:i(n).price,"onUpdate:modelValue":e[3]||(e[3]=l=>i(n).price=l),placeholder:"请设置套餐价格"},null,8,["modelValue"])]),_:1}),t(u,{label:"售卖状态",prop:"status"},{default:o(()=>[t(te,{modelValue:i(n).status,"onUpdate:modelValue":e[4]||(e[4]=l=>i(n).status=l)},{default:o(()=>[(d(!0),m(C,null,U(i(z),l=>(d(),D(le,{key:l.value,label:parseInt(l.value)},{default:o(()=>[f(_(l.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(u,{label:"套餐图片",prop:"image"},{default:o(()=>[t(ae,{modelValue:i(n).image,"onUpdate:modelValue":e[5]||(e[5]=l=>i(n).image=l)},null,8,["modelValue"])]),_:1}),t(u,{label:"套餐描述:",prop:"description"},{default:o(()=>[t(r,{modelValue:i(n).description,"onUpdate:modelValue":e[6]||(e[6]=l=>i(n).description=l),type:"textarea",rows:3,placeholder:"套餐描述，最长200字",maxlength:"200"},null,8,["modelValue"])]),_:1}),t(u,{label:"套餐菜品:",class:"setmealFood"},{default:o(()=>[t(u,null,{default:o(()=>[s("div",Le,[v.value.length===0?X((d(),D(g,{key:0,type:"primary",onClick:B},{default:o(()=>[f("+ 添加菜品")]),_:1})),[[ce,["setmeal:setmeal:add"]]]):I("",!0),v.value.length!==0?(d(),m("div",xe,[s("div",Se,[t(g,{type:"primary",onClick:B},{default:o(()=>[f(" + 添加菜品 ")]),_:1}),t(u,{class:"price-form-item",style:{"margin-left":"auto"},label:"套餐原价:"},{default:o(()=>[f(_(w.value),1)]),_:1})]),s("div",De,[t(se,{data:v.value,style:{width:"100%"}},{default:o(()=>[t(S,{prop:"name",label:"名称",width:"180",align:"center"}),t(S,{prop:"price",label:"原价",width:"180",align:"center"},{default:o(l=>[f(_(Number(l.row.price)),1)]),_:1}),t(S,{prop:"copies",label:"份数",align:"center"},{default:o(l=>[t(oe,{modelValue:l.row.copies,"onUpdate:modelValue":p=>l.row.copies=p,size:"small",min:1,max:99,label:"描述文字"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(S,{label:"操作",width:"180px",align:"center"},{default:o(l=>[t(g,{type:"link",size:"small",onClick:p=>W(l.$index)},{default:o(()=>[f(" 删除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])])])):I("",!0)])]),_:1})]),_:1}),s("div",Ne,[t(u,null,{default:o(()=>[t(g,{onClick:R},{default:o(()=>[f("取消")]),_:1}),t(g,{type:"primary",onClick:e[7]||(e[7]=l=>Z(!1))},{default:o(()=>[f("保存")]),_:1}),i(n).id?I("",!0):(d(),D(g,{key:0,type:"info",class:"continue",onClick:e[8]||(e[8]=l=>Z(!0))},{default:o(()=>[f(" 保存并继续添加套餐 ")]),_:1}))]),_:1})])]),_:1},8,["model","rules"]),t(ue,{title:"添加菜品",class:"addDishList",modelValue:V.value,"onUpdate:modelValue":e[11]||(e[11]=l=>V.value=l),width:"60%","before-close":E},{footer:o(()=>[s("span",We,[t(g,{onClick:E},{default:o(()=>[f("取消")]),_:1}),t(g,{type:"primary",onClick:Y},{default:o(()=>[f("确定")]),_:1})])]),default:o(()=>[t(r,{modelValue:A.value,"onUpdate:modelValue":e[9]||(e[9]=l=>A.value=l),class:"seachDish",placeholder:"请输入菜品名称进行搜索",style:{width:"250px"},clearable:"",onInput:G},{prefix:o(()=>[t(g,{icon:i(he),size:"small",circle:"",onClick:G},null,8,["icon"])]),_:1},8,["modelValue"]),s("div",Qe,[s("div",Ze,[X(s("div",Be,[(d(!0),m(C,null,U(x.value,(l,p)=>(d(),m("span",{key:p,class:be({act:p===N.value}),onClick:de=>K(p,l.id)},_(l.name),11,Ee))),128))],512),[[ye,A.value===""]]),s("div",Ge,[s("div",Re,[y.value.length===0?(d(),m("div",qe," 暂无菜品! ")):I("",!0),y.value.length>0?(d(),D(re,{key:1,modelValue:h.value,"onUpdate:modelValue":e[10]||(e[10]=l=>h.value=l),onChange:J},{default:o(()=>[(d(!0),m(C,null,U(y.value,(l,p)=>(d(),m("div",{key:p,class:"items"},[t(ie,{label:l},{default:o(()=>[s("div",Xe,[s("span",Fe,_(l.name),1),s("span",null,_(l.status===0?"停售":"在售"),1),s("span",null,_(Number(l.price)),1)])]),_:2},1032,["label"])]))),128))]),_:1},8,["modelValue"])):I("",!0)])])]),s("div",Oe,[s("div",ze,"已选菜品("+_(h.value.length)+")",1),s("div",Me,[(d(!0),m(C,null,U(h.value,(l,p)=>(d(),m("div",{key:p,class:"item"},[s("span",null,_(l.name),1),s("span",je,"￥ "+_(Number(l.price)),1),s("span",{class:"del",onClick:de=>T(p)},Ye,8,He)]))),128))])])])]),_:1},8,["modelValue"])])}}};export{ll as default};
