import{r as d,D as Ue,H as Ne,G as Z,d as i,I as ee,o as r,c as D,L as b,O as le,f as a,h as t,i as o,l as Le,J as S,K as F,m as g,p as c,e as L,A as $,C as $e,x as Ie}from"./index-B5XNB-yB.js";import{l as qe,g as Ee,u as Te,a as Pe,d as Re}from"./dish-CZ97_zVS.js";import{l as ae}from"./category-BasmY3_F.js";const Oe={class:"app-container"},Be={class:"dialog-footer"},ze=$e({name:"Dish"}),je=Object.assign(ze,{setup(Ae){const{proxy:_}=Ie(),{dish_status:I}=_.useDict("dish_status"),Q=d([]),y=d([]),w=d(!1),q=d(!0),E=d(!0),T=d([]),P=d([]),j=d(!0),G=d(!0),R=d(0),O=d(""),te=Ue({form:{},queryParams:{pageNum:1,pageSize:10,name:null,categoryId:null,status:null,categoryName:null},rules:{name:[{required:!0,message:"菜品名称不能为空",trigger:"blur"}],price:[{required:!0,message:"菜品价格不能为空",trigger:"blur"}],image:[{required:!0,message:"图片不能为空",trigger:"blur"}],status:[{required:!0,message:"售卖状态不能为空",trigger:"change"}],categoryId:[{required:!0,message:"菜品分类不能为空",trigger:"change"}]}}),{queryParams:p,form:u,rules:ne}=Ne(te),x={},oe=async()=>{try{(await ae()).rows.forEach(e=>{e.type===0&&(x[e.id]=e.name)}),console.log("Names of type 0:",x)}catch(n){console.log("发生错误：",n)}},B=d({}),ue=async()=>{try{(await ae(p.value)).rows.forEach(e=>{B.value[e.id]=e.name})}catch(n){console.log("发生错误：",n)}console.log("categoryNames.value:",B.value)};Z(()=>{ue(),oe()});const z=d([{name:"辣度",value:["不辣","微辣","中辣","重辣"]},{name:"忌口",value:["不要葱","不要蒜","不要香菜","不要辣"]},{name:"甜味",value:["无糖","少糖","半糖","多糖"]},{name:"温度",value:["热饮","常温","去冰","少冰","多冰"]}]),A=d([]);function ie(n){n.value=[],A.value=z.value.find(e=>e.name==n.name).value}function se(n){A.value=z.value.find(e=>e.name==n.name).value}function V(){q.value=!0,qe(p.value).then(n=>{Q.value=n.rows,R.value=n.total,q.value=!1})}function re(){w.value=!1,J()}function J(){u.value={id:null,name:null,categoryId:null,price:null,image:null,description:null,status:null,createTime:null,updateTime:null},y.value=[],_.resetForm("dishRef")}function K(){p.value.pageNum=1,V()}function de(){_.resetForm("queryRef"),K()}function ce(n){T.value=n.map(e=>e.id),j.value=n.length!=1,G.value=!n.length}function pe(){J(),w.value=!0,O.value="添加菜品管理"}function H(n){J();const e=n.id||T.value;Ee(e).then(h=>{u.value=h.data,x.value=h.data.categoryList,y.value=h.data.dishFlavorList,y.value!=null&&y.value.forEach(m=>{m.value=JSON.parse(m.value)}),w.value=!0,O.value="修改菜品管理"})}function me(){_.$refs.dishRef.validate(n=>{n&&(u.value.categoryList=x.value,u.value.dishFlavorList=y.value,u.value.dishFlavorList&&u.value.dishFlavorList.forEach(e=>{e.value=JSON.stringify(e.value)}),u.value.id!=null?Te(u.value).then(e=>{_.$modal.msgSuccess("修改成功"),w.value=!1,V()}):Pe(u.value).then(e=>{_.$modal.msgSuccess("新增成功"),w.value=!1,V()}))})}function M(n){const e=n.id||T.value;_.$modal.confirm('是否确认删除菜品管理编号为"'+e+'"的数据项？').then(function(){return Re(e)}).then(()=>{V(),_.$modal.msgSuccess("删除成功")}).catch(()=>{})}function ve({row:n,rowIndex:e}){n.index=e+1}function fe(){let n={};n.name="",n.value="",y.value.push(n)}function ge(){if(P.value.length==0)_.$modal.msgError("请先选择要删除的菜品口味关系数据");else{const n=y.value,e=P.value;y.value=n.filter(function(h){return e.indexOf(h.index)==-1})}}function _e(n){P.value=n.map(e=>e.index)}function he(){_.download("dish/dish/export",{...p.value},`dish_${new Date().getTime()}.xlsx`)}return Z(()=>{V()}),(n,e)=>{const h=i("el-input"),m=i("el-form-item"),U=i("el-option"),N=i("el-select"),v=i("el-button"),W=i("el-form"),C=i("el-col"),ye=i("right-toolbar"),X=i("el-row"),f=i("el-table-column"),be=i("image-preview"),we=i("dict-tag"),Y=i("el-table"),Ve=i("pagination"),Ce=i("image-upload"),ke=i("el-radio"),De=i("el-radio-group"),xe=i("el-divider"),Se=i("el-dialog"),k=ee("hasPermi"),Fe=ee("loading");return r(),D("div",Oe,[b(a(W,{model:o(p),ref:"queryRef",inline:!0,"label-width":"68px"},{default:t(()=>[a(m,{label:"菜品名称",prop:"name"},{default:t(()=>[a(h,{modelValue:o(p).name,"onUpdate:modelValue":e[0]||(e[0]=l=>o(p).name=l),placeholder:"请输入菜品名称",clearable:"",onKeyup:Le(K,["enter"])},null,8,["modelValue"])]),_:1}),a(m,{label:"售卖状态",prop:"status"},{default:t(()=>[a(N,{modelValue:o(p).status,"onUpdate:modelValue":e[1]||(e[1]=l=>o(p).status=l),placeholder:"请选择售卖状态",clearable:""},{default:t(()=>[(r(!0),D(S,null,F(o(I),l=>(r(),g(U,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(m,null,{default:t(()=>[a(v,{type:"primary",icon:"Search",onClick:K},{default:t(()=>[c("搜索")]),_:1}),a(v,{icon:"Refresh",onClick:de},{default:t(()=>[c("重置")]),_:1})]),_:1})]),_:1},8,["model"]),[[le,E.value]]),a(X,{gutter:10,class:"mb8"},{default:t(()=>[a(C,{span:1.5},{default:t(()=>[b((r(),g(v,{type:"primary",plain:"",icon:"Plus",onClick:pe},{default:t(()=>[c("新增")]),_:1})),[[k,["dish:dish:add"]]])]),_:1}),a(C,{span:1.5},{default:t(()=>[b((r(),g(v,{type:"success",plain:"",icon:"Edit",disabled:j.value,onClick:H},{default:t(()=>[c("修改")]),_:1},8,["disabled"])),[[k,["dish:dish:edit"]]])]),_:1}),a(C,{span:1.5},{default:t(()=>[b((r(),g(v,{type:"danger",plain:"",icon:"Delete",disabled:G.value,onClick:M},{default:t(()=>[c("删除")]),_:1},8,["disabled"])),[[k,["dish:dish:remove"]]])]),_:1}),a(C,{span:1.5},{default:t(()=>[b((r(),g(v,{type:"warning",plain:"",icon:"Download",onClick:he},{default:t(()=>[c("导出")]),_:1})),[[k,["dish:dish:export"]]])]),_:1}),a(ye,{showSearch:E.value,"onUpdate:showSearch":e[2]||(e[2]=l=>E.value=l),onQueryTable:V},null,8,["showSearch"])]),_:1}),b((r(),g(Y,{data:Q.value,onSelectionChange:ce},{default:t(()=>[a(f,{type:"selection",width:"55",align:"center"}),a(f,{label:"菜品名称",align:"center",prop:"name"}),a(f,{label:"图片",align:"center",prop:"image",width:"100"},{default:t(l=>[a(be,{src:l.row.image,width:50,height:50},null,8,["src"])]),_:1}),a(f,{label:"菜品分类",align:"center"},{default:t(l=>[L("span",null,$(B.value[l.row.categoryId]||"加载中..."),1)]),_:1}),a(f,{label:"菜品价格",align:"center"},{default:t(l=>[L("span",null,"￥"+$(l.row.price),1)]),_:1}),a(f,{label:"售卖状态",align:"center",prop:"status"},{default:t(l=>[a(we,{options:o(I),value:l.row.status},null,8,["options","value"])]),_:1}),a(f,{label:"更新时间",align:"center",prop:"updateTime",width:"180"},{default:t(l=>[L("span",null,$(n.parseTime(l.row.updateTime,"{y}-{m}-{d} {h}:{i}:{s}")),1)]),_:1}),a(f,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:t(l=>[b((r(),g(v,{link:"",type:"primary",icon:"Edit",onClick:s=>H(l.row)},{default:t(()=>[c("修改")]),_:2},1032,["onClick"])),[[k,["dish:dish:edit"]]]),b((r(),g(v,{link:"",type:"primary",icon:"Delete",onClick:s=>M(l.row)},{default:t(()=>[c("删除")]),_:2},1032,["onClick"])),[[k,["dish:dish:remove"]]])]),_:1})]),_:1},8,["data"])),[[Fe,q.value]]),b(a(Ve,{total:R.value,page:o(p).pageNum,"onUpdate:page":e[3]||(e[3]=l=>o(p).pageNum=l),limit:o(p).pageSize,"onUpdate:limit":e[4]||(e[4]=l=>o(p).pageSize=l),onPagination:V},null,8,["total","page","limit"]),[[le,R.value>0]]),a(Se,{title:O.value,modelValue:w.value,"onUpdate:modelValue":e[12]||(e[12]=l=>w.value=l),width:"500px","append-to-body":""},{footer:t(()=>[L("div",Be,[a(v,{type:"primary",onClick:me},{default:t(()=>[c("确 定")]),_:1}),a(v,{onClick:re},{default:t(()=>[c("取 消")]),_:1})])]),default:t(()=>[a(W,{ref:"dishRef",model:o(u),rules:o(ne),"label-width":"80px"},{default:t(()=>[a(m,{label:"菜品名称",prop:"name"},{default:t(()=>[a(h,{modelValue:o(u).name,"onUpdate:modelValue":e[5]||(e[5]=l=>o(u).name=l),placeholder:"请输入菜品名称"},null,8,["modelValue"])]),_:1}),a(m,{label:"菜品分类",prop:"categoryId"},{default:t(()=>[a(N,{modelValue:o(u).categoryId,"onUpdate:modelValue":e[6]||(e[6]=l=>o(u).categoryId=l),placeholder:"请选择菜品分类",style:{width:"150px"},onChange:e[7]||(e[7]=l=>n.$forceUpdate()),clearable:""},{default:t(()=>[(r(),D(S,null,F(x,(l,s)=>a(U,{key:s,label:l,value:s},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(m,{label:"菜品价格",prop:"price"},{default:t(()=>[a(h,{modelValue:o(u).price,"onUpdate:modelValue":e[8]||(e[8]=l=>o(u).price=l),placeholder:"请输入菜品价格"},null,8,["modelValue"])]),_:1}),a(m,{label:"图片",prop:"image"},{default:t(()=>[a(Ce,{modelValue:o(u).image,"onUpdate:modelValue":e[9]||(e[9]=l=>o(u).image=l)},null,8,["modelValue"])]),_:1}),a(m,{label:"描述信息",prop:"description"},{default:t(()=>[a(h,{modelValue:o(u).description,"onUpdate:modelValue":e[10]||(e[10]=l=>o(u).description=l),placeholder:"请输入描述信息"},null,8,["modelValue"])]),_:1}),a(m,{label:"售卖状态",prop:"status"},{default:t(()=>[a(De,{modelValue:o(u).status,"onUpdate:modelValue":e[11]||(e[11]=l=>o(u).status=l)},{default:t(()=>[(r(!0),D(S,null,F(o(I),l=>(r(),g(ke,{key:l.value,label:parseInt(l.value)},{default:t(()=>[c($(l.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(xe,{"content-position":"center"},{default:t(()=>[c("菜品口味关系信息")]),_:1}),a(X,{gutter:10,class:"mb8"},{default:t(()=>[a(C,{span:1.5},{default:t(()=>[a(v,{type:"primary",icon:"Plus",onClick:fe},{default:t(()=>[c("添加")]),_:1})]),_:1}),a(C,{span:1.5},{default:t(()=>[a(v,{type:"danger",icon:"Delete",onClick:ge},{default:t(()=>[c("删除")]),_:1})]),_:1})]),_:1}),a(Y,{data:y.value,"row-class-name":ve,onSelectionChange:_e,ref:"dishFlavor"},{default:t(()=>[a(f,{type:"selection",width:"50",align:"center"}),a(f,{label:"序号",align:"center",prop:"index",width:"50"}),a(f,{label:"口味名称",prop:"name",width:"150"},{default:t(l=>[a(N,{modelValue:l.row.name,"onUpdate:modelValue":s=>l.row.name=s,placeholder:"请选择口味名称",onChange:s=>ie(l.row)},{default:t(()=>[(r(!0),D(S,null,F(z.value,s=>(r(),g(U,{key:s.name,label:s.name,value:s.name},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),a(f,{label:"口味列表",prop:"value",width:"150"},{default:t(l=>[a(N,{modelValue:l.row.value,"onUpdate:modelValue":s=>l.row.value=s,placeholder:"请选择口味列表",multiple:"",onChange:s=>se(l.row)},{default:t(()=>[(r(!0),D(S,null,F(A.value,s=>(r(),g(U,{key:s,label:s,value:s},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:1})]),_:1},8,["data"])]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}});export{je as default};
