import{r as i,D as se,H as re,G as ie,a as ue,d as r,I as K,o as u,c as R,L as c,O as B,f as a,h as l,i as s,l as x,J as ce,K as de,m,p as g,e as D,A as I,C as pe,x as me}from"./index-B5XNB-yB.js";import{l as z}from"./category-BasmY3_F.js";import{l as ge,d as _e}from"./setmeal-BfMh4nJs.js";const fe={class:"app-container"},ve=pe({name:"Setmeal"}),ke=Object.assign(ve,{setup(ye){const{proxy:f}=me(),{seal_system:N}=f.useDict("seal_system"),q=i([]);i([]),i(!1);const w=i(!0),C=i(!0),k=i([]);i([]);const U=i(!0),E=i(!0),S=i(0);i("");const Q=se({form:{},queryParams:{pageNum:1,pageSize:10,categoryId:null,name:null,price:null,status:null},rules:{categoryId:[{required:!0,message:"套餐分类不能为空",trigger:"change"}],name:[{required:!0,message:"套餐名称不能为空",trigger:"blur"}],price:[{required:!0,message:"套餐价格不能为空",trigger:"blur"}],status:[{required:!0,message:"售卖状态不能为空",trigger:"change"}]}}),{queryParams:n,form:he}=re(Q),A={},F=async()=>{try{(await z(n.value)).rows.forEach(t=>{t.type===1&&(A[t.id]=t.name)})}catch(o){console.log("发生错误：",o)}},L=i({}),O=async()=>{try{(await z(n.value)).rows.forEach(t=>{L.value[t.id]=t.name})}catch(o){console.log("发生错误：",o)}};ie(()=>{O(),F()});function v(){w.value=!0,ge(n.value).then(o=>{q.value=o.rows,S.value=o.total,w.value=!1})}function y(){n.value.pageNum=1,v()}function j(){f.resetForm("queryRef"),y()}function G(o){k.value=o.map(t=>t.id),U.value=o.length!=1,E.value=!o.length}const P=ue(),H=()=>{P.push("/setmeal/setmeal-info/info")};function T(o){const t=o.id||k.value;o&&o.id?P.push({path:`/setmeal/setmeal-info/info/${t}`}):console.error("无法获取修改项的ID")}function $(o){const t=o.id||k.value;f.$modal.confirm('是否确认删除套餐编号为"'+t+'"的数据项？').then(function(){return _e(t)}).then(()=>{v(),f.$modal.msgSuccess("删除成功")}).catch(()=>{})}function J(){f.download("setmeal/setmeal/export",{...n.value},`setmeal_${new Date().getTime()}.xlsx`)}return v(),(o,t)=>{const V=r("el-input"),h=r("el-form-item"),M=r("el-option"),W=r("el-select"),d=r("el-button"),X=r("el-form"),b=r("el-col"),Y=r("right-toolbar"),Z=r("el-row"),p=r("el-table-column"),ee=r("image-preview"),ae=r("dict-tag"),te=r("el-table"),le=r("pagination"),_=K("hasPermi"),oe=K("loading");return u(),R("div",fe,[c(a(X,{model:s(n),ref:"queryRef",inline:!0,"label-width":"68px"},{default:l(()=>[a(h,{label:"套餐分类",prop:"categoryId"},{default:l(()=>[a(V,{modelValue:s(n).categoryId,"onUpdate:modelValue":t[0]||(t[0]=e=>s(n).categoryId=e),placeholder:"请输入套餐分类",clearable:"",onKeyup:x(y,["enter"])},null,8,["modelValue"])]),_:1}),a(h,{label:"套餐名称",prop:"name"},{default:l(()=>[a(V,{modelValue:s(n).name,"onUpdate:modelValue":t[1]||(t[1]=e=>s(n).name=e),placeholder:"请输入套餐名称",clearable:"",onKeyup:x(y,["enter"])},null,8,["modelValue"])]),_:1}),a(h,{label:"套餐价格",prop:"price"},{default:l(()=>[a(V,{modelValue:s(n).price,"onUpdate:modelValue":t[2]||(t[2]=e=>s(n).price=e),placeholder:"请输入套餐价格",clearable:"",onKeyup:x(y,["enter"])},null,8,["modelValue"])]),_:1}),a(h,{label:"售卖状态",prop:"status"},{default:l(()=>[a(W,{modelValue:s(n).status,"onUpdate:modelValue":t[3]||(t[3]=e=>s(n).status=e),placeholder:"请选择售卖状态",clearable:""},{default:l(()=>[(u(!0),R(ce,null,de(s(N),e=>(u(),m(M,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(h,null,{default:l(()=>[a(d,{type:"primary",icon:"Search",onClick:y},{default:l(()=>[g("搜索")]),_:1}),a(d,{icon:"Refresh",onClick:j},{default:l(()=>[g("重置")]),_:1})]),_:1})]),_:1},8,["model"]),[[B,C.value]]),a(Z,{gutter:10,class:"mb8"},{default:l(()=>[a(b,{span:1.5},{default:l(()=>[c((u(),m(d,{plain:"",type:"primary",icon:"Plus",onClick:H},{default:l(()=>[g(" 新增 ")]),_:1})),[[_,["setmeal:setmeal:add"]]])]),_:1}),a(b,{span:1.5},{default:l(()=>[c((u(),m(d,{type:"success",plain:"",icon:"Edit",disabled:U.value,onClick:T},{default:l(()=>[g("修改")]),_:1},8,["disabled"])),[[_,["setmeal:setmeal:edit"]]])]),_:1}),a(b,{span:1.5},{default:l(()=>[c((u(),m(d,{type:"danger",plain:"",icon:"Delete",disabled:E.value,onClick:$},{default:l(()=>[g("删除")]),_:1},8,["disabled"])),[[_,["setmeal:setmeal:remove"]]])]),_:1}),a(b,{span:1.5},{default:l(()=>[c((u(),m(d,{type:"warning",plain:"",icon:"Download",onClick:J},{default:l(()=>[g("导出")]),_:1})),[[_,["setmeal:setmeal:export"]]])]),_:1}),a(Y,{showSearch:C.value,"onUpdate:showSearch":t[4]||(t[4]=e=>C.value=e),onQueryTable:v},null,8,["showSearch"])]),_:1}),c((u(),m(te,{data:q.value,onSelectionChange:G},{default:l(()=>[a(p,{type:"selection",width:"55",align:"center"}),a(p,{label:"套餐名称",align:"center",prop:"name"}),a(p,{label:"图片",align:"center",prop:"image",width:"100"},{default:l(e=>[a(ee,{src:e.row.image,width:50,height:50},null,8,["src"])]),_:1}),a(p,{label:"套餐分类",align:"center",prop:"categoryId"},{default:l(e=>[D("span",null,I(L.value[e.row.categoryId]||"加载中..."),1)]),_:1}),a(p,{label:"套餐价格",align:"center",prop:"price"},{default:l(e=>[D("span",null,"￥"+I(e.row.price),1)]),_:1}),a(p,{label:"售卖状态",align:"center",prop:"status"},{default:l(e=>[a(ae,{options:s(N),value:e.row.status},null,8,["options","value"])]),_:1}),a(p,{label:"更新时间",align:"center",prop:"updateTime",width:"180"},{default:l(e=>[D("span",null,I(o.parseTime(e.row.updateTime,"{y}-{m}-{d} {h}:{i}:{s}")),1)]),_:1}),a(p,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:l(e=>[c((u(),m(d,{link:"",type:"primary",icon:"Edit",onClick:ne=>T(e.row)},{default:l(()=>[g("修改")]),_:2},1032,["onClick"])),[[_,["setmeal:setmeal:edit"]]]),c((u(),m(d,{link:"",type:"primary",icon:"Delete",onClick:ne=>$(e.row)},{default:l(()=>[g("删除")]),_:2},1032,["onClick"])),[[_,["setmeal:setmeal:remove"]]])]),_:1})]),_:1},8,["data"])),[[oe,w.value]]),c(a(le,{total:S.value,page:s(n).pageNum,"onUpdate:page":t[5]||(t[5]=e=>s(n).pageNum=e),limit:s(n).pageSize,"onUpdate:limit":t[6]||(t[6]=e=>s(n).pageSize=e),onPagination:v},null,8,["total","page","limit"]),[[B,S.value>0]])])}}});export{ke as default};
