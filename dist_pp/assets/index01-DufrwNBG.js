import{r as m,D as qe,H as Ae,G as Ke,a as Be,d,I as te,o as _,c as x,L as h,O as oe,f as l,h as t,i as n,l as F,J as O,K as z,m as y,p as i,e as D,A as I,C as Fe,x as Oe}from"./index-B5XNB-yB.js";import{l as ne}from"./category-BasmY3_F.js";import{l as ze,g as Me,u as Qe,a as je,d as Ge}from"./setmeal-BfMh4nJs.js";import{t as He}from"./menu-B1PDVqnr.js";const Je={class:"app-container"},We={class:"dialog-footer"},Xe=Fe({name:"Setmeal"}),tl=Object.assign(Xe,{setup(Ye){const{proxy:v}=Oe(),{seal_system:T}=v.useDict("seal_system"),M=m([]),b=m([]),V=m(!1),$=m(!0),N=m(!0),L=m([]),R=m([]),Q=m(!0),j=m(!0),E=m(0),P=m(""),ue=qe({form:{},queryParams:{pageNum:1,pageSize:10,categoryId:null,name:null,price:null,status:null},rules:{categoryId:[{required:!0,message:"套餐分类不能为空",trigger:"change"}],name:[{required:!0,message:"套餐名称不能为空",trigger:"blur"}],price:[{required:!0,message:"套餐价格不能为空",trigger:"blur"}],status:[{required:!0,message:"售卖状态不能为空",trigger:"change"}]}}),{queryParams:s,form:u,rules:de}=Ae(ue),G={},re=async()=>{try{(await ne(s.value)).rows.forEach(a=>{a.type===1&&(G[a.id]=a.name)})}catch(o){console.log("发生错误：",o)}},H=m({}),se=async()=>{try{(await ne(s.value)).rows.forEach(a=>{H.value[a.id]=a.name})}catch(o){console.log("发生错误：",o)}};Ke(()=>{se(),re()});function w(){$.value=!0,ze(s.value).then(o=>{M.value=o.rows,E.value=o.total,$.value=!1})}function ie(){V.value=!1,q()}function q(){u.value={id:null,categoryId:null,name:null,price:null,status:null,code:null,description:null,image:null,createTime:null,updateTime:null},b.value=[],v.resetForm("setmealRef")}function S(){s.value.pageNum=1,w()}function me(){v.resetForm("queryRef"),S()}function pe(o){L.value=o.map(a=>a.id),Q.value=o.length!=1,j.value=!o.length}function ce(){q(),be(),V.value=!0,P.value="添加套餐"}const fe=Be(),ge=o=>{fe.push("/setmeal/setmeal-info/info/${data}")};function J(o){q();const a=o.id||L.value;Me(a).then(r=>{u.value=r.data,b.value=r.data.setmealDishList,V.value=!0,P.value="修改套餐"})}function _e(){v.$refs.setmealRef.validate(o=>{o&&(u.value.setmealDishList=b.value,u.value.id!=null?Qe(u.value).then(a=>{v.$modal.msgSuccess("修改成功"),V.value=!1,w()}):je(u.value).then(a=>{v.$modal.msgSuccess("新增成功"),V.value=!1,w()}))})}function W(o){const a=o.id||L.value;v.$modal.confirm('是否确认删除套餐编号为"'+a+'"的数据项？').then(function(){return Ge(a)}).then(()=>{w(),v.$modal.msgSuccess("删除成功")}).catch(()=>{})}function ve({row:o,rowIndex:a}){o.index=a+1}function he(){let o={};o.dishId="",o.name="",o.price="",o.copies="",o.sort="",b.value.push(o)}function ye(){if(R.value.length==0)v.$modal.msgError("请先选择要删除的套餐菜品关系数据");else{const o=b.value,a=R.value;b.value=o.filter(function(r){return a.indexOf(r.index)==-1})}}const U=m([]),X=m(!1),Y=m(!1),A=m(null);m(null);function be(){He().then(o=>{U.value=o.data})}function Ve(o,a){{let r=U.value;for(let p=0;p<r.length;p++)A.value.store.nodesMap[r[p].id].expanded=o}}function we(o,a){A.value.setCheckedNodes(o?U.value:[])}function ke(o,a){u.value.menuCheckStrictly=!!o}function Ce(o){R.value=o.map(a=>a.index)}function Se(){v.download("setmeal/setmeal/export",{...s.value},`setmeal_${new Date().getTime()}.xlsx`)}return w(),(o,a)=>{const r=d("el-input"),p=d("el-form-item"),Z=d("el-option"),ee=d("el-select"),g=d("el-button"),le=d("el-form"),k=d("el-col"),K=d("el-row"),Ue=d("right-toolbar"),c=d("el-table-column"),xe=d("image-preview"),De=d("dict-tag"),ae=d("el-table"),Ie=d("pagination"),Te=d("el-radio"),$e=d("el-radio-group"),Ne=d("image-upload"),B=d("el-checkbox"),Le=d("el-tree"),Re=d("el-divider"),Ee=d("el-dialog"),C=te("hasPermi"),Pe=te("loading");return _(),x("div",Je,[h(l(le,{model:n(s),ref:"queryRef",inline:!0,"label-width":"68px"},{default:t(()=>[l(p,{label:"套餐分类",prop:"categoryId"},{default:t(()=>[l(r,{modelValue:n(s).categoryId,"onUpdate:modelValue":a[0]||(a[0]=e=>n(s).categoryId=e),placeholder:"请输入套餐分类",clearable:"",onKeyup:F(S,["enter"])},null,8,["modelValue"])]),_:1}),l(p,{label:"套餐名称",prop:"name"},{default:t(()=>[l(r,{modelValue:n(s).name,"onUpdate:modelValue":a[1]||(a[1]=e=>n(s).name=e),placeholder:"请输入套餐名称",clearable:"",onKeyup:F(S,["enter"])},null,8,["modelValue"])]),_:1}),l(p,{label:"套餐价格",prop:"price"},{default:t(()=>[l(r,{modelValue:n(s).price,"onUpdate:modelValue":a[2]||(a[2]=e=>n(s).price=e),placeholder:"请输入套餐价格",clearable:"",onKeyup:F(S,["enter"])},null,8,["modelValue"])]),_:1}),l(p,{label:"售卖状态",prop:"status"},{default:t(()=>[l(ee,{modelValue:n(s).status,"onUpdate:modelValue":a[3]||(a[3]=e=>n(s).status=e),placeholder:"请选择售卖状态",clearable:""},{default:t(()=>[(_(!0),x(O,null,z(n(T),e=>(_(),y(Z,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(p,null,{default:t(()=>[l(g,{type:"primary",icon:"Search",onClick:S},{default:t(()=>[i("搜索")]),_:1}),l(g,{icon:"Refresh",onClick:me},{default:t(()=>[i("重置")]),_:1})]),_:1})]),_:1},8,["model"]),[[oe,N.value]]),l(K,{gutter:10,class:"mb8"},{default:t(()=>[l(k,{span:1.5},{default:t(()=>[h((_(),y(g,{type:"primary",plain:"",icon:"Plus",onClick:ce},{default:t(()=>[i("新增")]),_:1})),[[C,["setmeal:setmeal:add"]]]),l(K,{style:{"margin-bottom":"10px"}},{default:t(()=>[l(k,{span:5},{default:t(()=>[l(g,{plain:"",type:"primary",icon:"Plus",onClick:a[4]||(a[4]=e=>ge("add"))},{default:t(()=>[i(" 新增 ")]),_:1})]),_:1})]),_:1})]),_:1}),l(k,{span:1.5},{default:t(()=>[h((_(),y(g,{type:"success",plain:"",icon:"Edit",disabled:Q.value,onClick:J},{default:t(()=>[i("修改")]),_:1},8,["disabled"])),[[C,["setmeal:setmeal:edit"]]])]),_:1}),l(k,{span:1.5},{default:t(()=>[h((_(),y(g,{type:"danger",plain:"",icon:"Delete",disabled:j.value,onClick:W},{default:t(()=>[i("删除")]),_:1},8,["disabled"])),[[C,["setmeal:setmeal:remove"]]])]),_:1}),l(k,{span:1.5},{default:t(()=>[h((_(),y(g,{type:"warning",plain:"",icon:"Download",onClick:Se},{default:t(()=>[i("导出")]),_:1})),[[C,["setmeal:setmeal:export"]]])]),_:1}),l(Ue,{showSearch:N.value,"onUpdate:showSearch":a[5]||(a[5]=e=>N.value=e),onQueryTable:w},null,8,["showSearch"])]),_:1}),h((_(),y(ae,{data:M.value,onSelectionChange:pe},{default:t(()=>[l(c,{type:"selection",width:"55",align:"center"}),l(c,{label:"套餐名称",align:"center",prop:"name"}),l(c,{label:"图片",align:"center",prop:"image",width:"100"},{default:t(e=>[l(xe,{src:e.row.image,width:50,height:50},null,8,["src"])]),_:1}),l(c,{label:"套餐分类",align:"center",prop:"categoryId"},{default:t(e=>[D("span",null,I(H.value[e.row.categoryId]||"加载中..."),1)]),_:1}),l(c,{label:"套餐价格",align:"center",prop:"price"},{default:t(e=>[D("span",null,"￥"+I(e.row.price),1)]),_:1}),l(c,{label:"售卖状态",align:"center",prop:"status"},{default:t(e=>[l(De,{options:n(T),value:e.row.status},null,8,["options","value"])]),_:1}),l(c,{label:"更新时间",align:"center",prop:"updateTime",width:"180"},{default:t(e=>[D("span",null,I(o.parseTime(e.row.updateTime,"{y}-{m}-{d} {h}:{i}:{s}")),1)]),_:1}),l(c,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:t(e=>[h((_(),y(g,{link:"",type:"primary",icon:"Edit",onClick:f=>J(e.row)},{default:t(()=>[i("修改")]),_:2},1032,["onClick"])),[[C,["setmeal:setmeal:edit"]]]),h((_(),y(g,{link:"",type:"primary",icon:"Delete",onClick:f=>W(e.row)},{default:t(()=>[i("删除")]),_:2},1032,["onClick"])),[[C,["setmeal:setmeal:remove"]]])]),_:1})]),_:1},8,["data"])),[[Pe,$.value]]),h(l(Ie,{total:E.value,page:n(s).pageNum,"onUpdate:page":a[6]||(a[6]=e=>n(s).pageNum=e),limit:n(s).pageSize,"onUpdate:limit":a[7]||(a[7]=e=>n(s).pageSize=e),onPagination:w},null,8,["total","page","limit"]),[[oe,E.value>0]]),l(Ee,{title:P.value,modelValue:V.value,"onUpdate:modelValue":a[21]||(a[21]=e=>V.value=e),width:"500px","append-to-body":""},{footer:t(()=>[D("div",We,[l(g,{type:"primary",onClick:_e},{default:t(()=>[i("确 定")]),_:1}),l(g,{onClick:ie},{default:t(()=>[i("取 消")]),_:1})])]),default:t(()=>[l(le,{ref:"setmealRef",model:n(u),rules:n(de),"label-width":"80px"},{default:t(()=>[l(p,{label:"套餐分类",prop:"categoryId"},{default:t(()=>[l(ee,{modelValue:n(u).categoryId,"onUpdate:modelValue":a[8]||(a[8]=e=>n(u).categoryId=e),placeholder:"请输入套餐分类",onChange:a[9]||(a[9]=e=>o.$forceUpdate()),clearable:""},{default:t(()=>[(_(),x(O,null,z(G,(e,f)=>l(Z,{key:f,label:e,value:f},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(p,{label:"套餐名称",prop:"name"},{default:t(()=>[l(r,{modelValue:n(u).name,"onUpdate:modelValue":a[10]||(a[10]=e=>n(u).name=e),placeholder:"请输入套餐名称"},null,8,["modelValue"])]),_:1}),l(p,{label:"套餐价格",prop:"price"},{default:t(()=>[l(r,{modelValue:n(u).price,"onUpdate:modelValue":a[11]||(a[11]=e=>n(u).price=e),placeholder:"请输入套餐价格"},null,8,["modelValue"])]),_:1}),l(p,{label:"售卖状态",prop:"status"},{default:t(()=>[l($e,{modelValue:n(u).status,"onUpdate:modelValue":a[12]||(a[12]=e=>n(u).status=e)},{default:t(()=>[(_(!0),x(O,null,z(n(T),e=>(_(),y(Te,{key:e.value,label:parseInt(e.value)},{default:t(()=>[i(I(e.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(p,{label:"图片",prop:"image"},{default:t(()=>[l(Ne,{modelValue:n(u).image,"onUpdate:modelValue":a[13]||(a[13]=e=>n(u).image=e)},null,8,["modelValue"])]),_:1}),l(p,{label:"描述信息",prop:"description"},{default:t(()=>[l(r,{modelValue:n(u).description,"onUpdate:modelValue":a[14]||(a[14]=e=>n(u).description=e),type:"textarea",placeholder:"请输入内容"},null,8,["modelValue"])]),_:1}),l(p,{label:"套餐菜品"},{default:t(()=>[l(B,{modelValue:X.value,"onUpdate:modelValue":a[15]||(a[15]=e=>X.value=e),onChange:a[16]||(a[16]=e=>Ve(e,"menu"))},{default:t(()=>[i("展开/折叠")]),_:1},8,["modelValue"]),l(B,{modelValue:Y.value,"onUpdate:modelValue":a[17]||(a[17]=e=>Y.value=e),onChange:a[18]||(a[18]=e=>we(e,"menu"))},{default:t(()=>[i("全选/全不选")]),_:1},8,["modelValue"]),l(B,{modelValue:n(u).menuCheckStrictly,"onUpdate:modelValue":a[19]||(a[19]=e=>n(u).menuCheckStrictly=e),onChange:a[20]||(a[20]=e=>ke(e,"menu"))},{default:t(()=>[i("父子联动")]),_:1},8,["modelValue"]),l(Le,{class:"tree-border",data:U.value,"show-checkbox":"",ref_key:"menuRef",ref:A,"node-key":"id","check-strictly":!n(u).menuCheckStrictly,"empty-text":"加载中，请稍候",props:{label:"label",children:"children"}},null,8,["data","check-strictly"])]),_:1}),l(Re,{"content-position":"center"},{default:t(()=>[i("套餐菜品关系信息")]),_:1}),l(K,{gutter:10,class:"mb8"},{default:t(()=>[l(k,{span:1.5},{default:t(()=>[l(g,{type:"primary",icon:"Plus",onClick:he},{default:t(()=>[i("添加")]),_:1})]),_:1}),l(k,{span:1.5},{default:t(()=>[l(g,{type:"danger",icon:"Delete",onClick:ye},{default:t(()=>[i("删除")]),_:1})]),_:1})]),_:1}),l(ae,{data:b.value,"row-class-name":ve,onSelectionChange:Ce,ref:"setmealDish"},{default:t(()=>[l(c,{type:"selection",width:"50",align:"center"}),l(c,{label:"菜品id",prop:"dishId",width:"150"},{default:t(e=>[l(r,{modelValue:e.row.dishId,"onUpdate:modelValue":f=>e.row.dishId=f,placeholder:"请输入菜品id"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(c,{label:"菜品名称 ",prop:"name",width:"150"},{default:t(e=>[l(r,{modelValue:e.row.name,"onUpdate:modelValue":f=>e.row.name=f,placeholder:"请输入菜品名称 "},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(c,{label:"菜品原价",prop:"price",width:"150"},{default:t(e=>[l(r,{modelValue:e.row.price,"onUpdate:modelValue":f=>e.row.price=f,placeholder:"请输入菜品原价"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(c,{label:"份数",prop:"copies",width:"150"},{default:t(e=>[l(r,{modelValue:e.row.copies,"onUpdate:modelValue":f=>e.row.copies=f,placeholder:"请输入份数"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(c,{label:"排序",prop:"sort",width:"150"},{default:t(e=>[l(r,{modelValue:e.row.sort,"onUpdate:modelValue":f=>e.row.sort=f,placeholder:"请输入排序"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["data"])]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}});export{tl as default};
