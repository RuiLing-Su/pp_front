import{r as u,D as de,H as pe,G as me,a as ge,d as r,I as K,o as i,c as B,L as p,O as z,f as t,h as a,i as s,l as x,J as _e,K as fe,m as g,p as m,e as D,A as I,C as ve,x as ye}from"./index-B5XNB-yB.js";import{l as F}from"./category-BasmY3_F.js";import{l as he,g as be,d as we}from"./setmeal-BfMh4nJs.js";const Ce={class:"app-container"},Se=ve({name:"Setmeal"}),Ie=Object.assign(Se,{setup(ke){const{proxy:_}=ye(),{seal_system:N}=_.useDict("seal_system"),T=u([]),q=u([]),Q=u(!1),C=u(!0),S=u(!0),k=u([]);u([]);const L=u(!0),U=u(!0),V=u(0),A=u(""),O=de({form:{},queryParams:{pageNum:1,pageSize:10,categoryId:null,name:null,price:null,status:null},rules:{categoryId:[{required:!0,message:"套餐分类不能为空",trigger:"change"}],name:[{required:!0,message:"套餐名称不能为空",trigger:"blur"}],price:[{required:!0,message:"套餐价格不能为空",trigger:"blur"}],status:[{required:!0,message:"售卖状态不能为空",trigger:"change"}]}}),{queryParams:o,form:P}=pe(O),j={},G=async()=>{try{(await F(o.value)).rows.forEach(l=>{l.type===1&&(j[l.id]=l.name)})}catch(n){console.log("发生错误：",n)}},$=u({}),H=async()=>{try{(await F(o.value)).rows.forEach(l=>{$.value[l.id]=l.name})}catch(n){console.log("发生错误：",n)}};me(()=>{H(),G()});function v(){C.value=!0,he(o.value).then(n=>{T.value=n.rows,V.value=n.total,C.value=!1})}function J(){P.value={id:null,categoryId:null,name:null,price:null,status:null,code:null,description:null,image:null,createTime:null,updateTime:null},q.value=[],_.resetForm("setmealRef")}function y(){o.value.pageNum=1,v()}function M(){_.resetForm("queryRef"),y()}function W(n){k.value=n.map(l=>l.id),L.value=n.length!=1,U.value=!n.length}const X=ge(),Y=n=>{X.push("/setmeal/setmeal-info/info/${data}")};function E(n){J();const l=n.id||k.value;be(l).then(f=>{P.value=f.data,q.value=f.data.setmealDishList,Q.value=!0,A.value="修改套餐"})}function R(n){const l=n.id||k.value;_.$modal.confirm('是否确认删除套餐编号为"'+l+'"的数据项？').then(function(){return we(l)}).then(()=>{v(),_.$modal.msgSuccess("删除成功")}).catch(()=>{})}function Z(){_.download("setmeal/setmeal/export",{...o.value},`setmeal_${new Date().getTime()}.xlsx`)}return v(),(n,l)=>{const f=r("el-input"),h=r("el-form-item"),ee=r("el-option"),le=r("el-select"),c=r("el-button"),te=r("el-form"),w=r("el-col"),ae=r("right-toolbar"),ne=r("el-row"),d=r("el-table-column"),oe=r("image-preview"),se=r("dict-tag"),re=r("el-table"),ue=r("pagination"),b=K("hasPermi"),ie=K("loading");return i(),B("div",Ce,[p(t(te,{model:s(o),ref:"queryRef",inline:!0,"label-width":"68px"},{default:a(()=>[t(h,{label:"套餐分类",prop:"categoryId"},{default:a(()=>[t(f,{modelValue:s(o).categoryId,"onUpdate:modelValue":l[0]||(l[0]=e=>s(o).categoryId=e),placeholder:"请输入套餐分类",clearable:"",onKeyup:x(y,["enter"])},null,8,["modelValue"])]),_:1}),t(h,{label:"套餐名称",prop:"name"},{default:a(()=>[t(f,{modelValue:s(o).name,"onUpdate:modelValue":l[1]||(l[1]=e=>s(o).name=e),placeholder:"请输入套餐名称",clearable:"",onKeyup:x(y,["enter"])},null,8,["modelValue"])]),_:1}),t(h,{label:"套餐价格",prop:"price"},{default:a(()=>[t(f,{modelValue:s(o).price,"onUpdate:modelValue":l[2]||(l[2]=e=>s(o).price=e),placeholder:"请输入套餐价格",clearable:"",onKeyup:x(y,["enter"])},null,8,["modelValue"])]),_:1}),t(h,{label:"售卖状态",prop:"status"},{default:a(()=>[t(le,{modelValue:s(o).status,"onUpdate:modelValue":l[3]||(l[3]=e=>s(o).status=e),placeholder:"请选择售卖状态",clearable:""},{default:a(()=>[(i(!0),B(_e,null,fe(s(N),e=>(i(),g(ee,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(h,null,{default:a(()=>[t(c,{type:"primary",icon:"Search",onClick:y},{default:a(()=>[m("搜索")]),_:1}),t(c,{icon:"Refresh",onClick:M},{default:a(()=>[m("重置")]),_:1})]),_:1})]),_:1},8,["model"]),[[z,S.value]]),t(ne,{gutter:10,class:"mb8"},{default:a(()=>[t(w,{span:1.5},{default:a(()=>[t(c,{plain:"",type:"primary",icon:"Plus",onClick:l[4]||(l[4]=e=>Y("add"))},{default:a(()=>[m(" 新增 ")]),_:1})]),_:1}),t(w,{span:1.5},{default:a(()=>[p((i(),g(c,{type:"success",plain:"",icon:"Edit",disabled:L.value,onClick:E},{default:a(()=>[m("修改")]),_:1},8,["disabled"])),[[b,["setmeal:setmeal:edit"]]])]),_:1}),t(w,{span:1.5},{default:a(()=>[p((i(),g(c,{type:"danger",plain:"",icon:"Delete",disabled:U.value,onClick:R},{default:a(()=>[m("删除")]),_:1},8,["disabled"])),[[b,["setmeal:setmeal:remove"]]])]),_:1}),t(w,{span:1.5},{default:a(()=>[p((i(),g(c,{type:"warning",plain:"",icon:"Download",onClick:Z},{default:a(()=>[m("导出")]),_:1})),[[b,["setmeal:setmeal:export"]]])]),_:1}),t(ae,{showSearch:S.value,"onUpdate:showSearch":l[5]||(l[5]=e=>S.value=e),onQueryTable:v},null,8,["showSearch"])]),_:1}),p((i(),g(re,{data:T.value,onSelectionChange:W},{default:a(()=>[t(d,{type:"selection",width:"55",align:"center"}),t(d,{label:"套餐名称",align:"center",prop:"name"}),t(d,{label:"图片",align:"center",prop:"image",width:"100"},{default:a(e=>[t(oe,{src:e.row.image,width:50,height:50},null,8,["src"])]),_:1}),t(d,{label:"套餐分类",align:"center",prop:"categoryId"},{default:a(e=>[D("span",null,I($.value[e.row.categoryId]||"加载中..."),1)]),_:1}),t(d,{label:"套餐价格",align:"center",prop:"price"},{default:a(e=>[D("span",null,"￥"+I(e.row.price),1)]),_:1}),t(d,{label:"售卖状态",align:"center",prop:"status"},{default:a(e=>[t(se,{options:s(N),value:e.row.status},null,8,["options","value"])]),_:1}),t(d,{label:"更新时间",align:"center",prop:"updateTime",width:"180"},{default:a(e=>[D("span",null,I(n.parseTime(e.row.updateTime,"{y}-{m}-{d} {h}:{i}:{s}")),1)]),_:1}),t(d,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:a(e=>[p((i(),g(c,{link:"",type:"primary",icon:"Edit",onClick:ce=>E(e.row)},{default:a(()=>[m("修改")]),_:2},1032,["onClick"])),[[b,["setmeal:setmeal:edit"]]]),p((i(),g(c,{link:"",type:"primary",icon:"Delete",onClick:ce=>R(e.row)},{default:a(()=>[m("删除")]),_:2},1032,["onClick"])),[[b,["setmeal:setmeal:remove"]]])]),_:1})]),_:1},8,["data"])),[[ie,C.value]]),p(t(ue,{total:V.value,page:s(o).pageNum,"onUpdate:page":l[6]||(l[6]=e=>s(o).pageNum=e),limit:s(o).pageSize,"onUpdate:limit":l[7]||(l[7]=e=>s(o).pageSize=e),onPagination:v},null,8,["total","page","limit"]),[[z,V.value>0]])])}}});export{Ie as default};
